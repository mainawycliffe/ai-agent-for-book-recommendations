mutation upsertUser($uid: String!, $name: String, $email: String)
@auth(expr: "auth.uid == uid") {
  user_upsert(
    data: {
      name: $name
      email: $email
      uid: $uid
      createdAt_expr: "request.time"
    }
  )
}

mutation upsertBook(
  $id: UUID!
  $title: String!
  $summary: String!
  $genre: [String!]!
  $authors: [String!]!
  $publishedDate: Timestamp!
  $content: String!
  $imageUrl: String!
) @auth(level: USER) {
  book_upsert(
    data: {
      id: $id
      title: $title
      summary: $summary
      imageUrl: $imageUrl
      genre: $genre
      authors: $authors
      publishedDate: $publishedDate
      content: $content
      contentEmbed_embed: { model: "text-embedding-005", text: $content }
    }
  )
}
